<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<div class="text-center">
    <h1 style="background-color: gray">Users table</h1>
</div>
</head>
<body style="background-color: #c2ffb4">
<div class="d-flex">
    <button class="btn btn-outline-success" data-toggle="modal" data-target="#addUser">add new user</button>
    <button class="btn btn-warning" ><a href="/logout">logout</a></button>
</div>
<div class="container">
    <table id="users_table" class="table table-hover table-striped">
    </table>
</div>
<!--//POST Method:-->
<!--Modal-->
<div class="modal fade" id="addUser" tabindex="-1" aria-labelledby="#addUserLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addUserLabel">Form</h5>
                <button class="btn close" data-dismiss="modal" aria-label="close"></button>
            </div>
            <div class="modal-body">
                <form id="register" method="post" >
                    <div class="form-group" align="center">
                        <label for="name">Name</label>
                        <br>
                        <input type="text" class="control-input col-sm-10" id="name" placeholder="Name">
                    </div>
                    <div class="form-group" align="center">
                        <label for="password">Password</label>
                        <br>
                        <input type="text" class="control-input col-sm-10" id="password" placeholder="Password">
                    </div>
                    <div class="form-group" align="center">
                        <label   for="age">Age</label>
                        <br>
                        <input type="number" class="control-input col-sm-10"id="age" placeholder="age">
                    </div>
                    <div class="form-group" align="center">
                    </div>
                    <!--                    <a href="#" class="card-link">Edit</a>-->
                    <!--                    <a href="#" class="card-link">Delete</a>-->
                    <!--                    <div class="form-group" align="center">-->
                    <!--                        <input type="submit" value="add User">-->
                    <!--                    </div>-->
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button class="btn btn-outline-success" type="submit">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!--Modal-->
<!--//Put method:-->
<!--Modal-->
<!--aria-labelledby="#updateUserLabel"-->
<!--aria-hidden="true"-->
<div class="modal fade" id="UpdateUser" tabindex="-1"  >
    <!--     <div id="EditUserTest">-->
    <!--         edit-->
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editUserLabel">Form</h5>
                <button class="btn close" data-dismiss="modal" aria-label="close"></button>
            </div>
            <div class="modal-body">
                <div id="EditUserTest">
                </div>
            </div>
        </div>
    </div>
    <!--     </div>-->
</div>
<!--<script src="JS.js"></script>-->
<script>
    //post method:
    const admin = document.getElementById('register')
    let url = 'http://localhost:8000/api/users'
    admin.addEventListener('submit', function (event) {
        event.preventDefault();
        let name = document.getElementById('name').value;
        let password = document.getElementById('password').value;
        let age = document.getElementById('age').value;
        console.log(name)
        console.log(password)
        console.log(age)
        fetch(url, {
            method: "POST",
            headers: {
                'Content-type': 'application/json'
            },
            body: JSON.stringify({
                name: name,
                password: password,
                age: age,
            })
        }).then(function (response) {
            return response.json()
        }).then(function (data) {
            console.log(data)
        })
        setTimeout(test,300);
        function test() {
            document.location.href = 'http://localhost:8000/api/admin'
        }
    });
    //Delete method:
    const table = document.querySelector('table');
    table.addEventListener('click', (e) => {
        e.preventDefault()
        let deleteButton = e.target.id === 'delete-post';
        let userId = e.target.parentElement.dataset.id;
        if (deleteButton) {
            fetch(`${url}/${userId}`, {
                method: 'DELETE',
            })
                .then(res => res.text())
                .then(() => location.reload())
        }
    });
    //Update method:
    // const adminEdit = document.getElementById('registerEdit')
    // let url = 'http://localhost:8000/api/users'
    //
    // adminEdit.addEventListener('submit', function (event) {
    //     event.preventDefault();
    //     let name = document.getElementById('name').value;
    //     let password = document.getElementById('password').value;
    //     let age = document.getElementById('age').value;
    //     console.log(name)
    //     console.log(password)
    //     console.log(age)
    //     fetch(url, {
    //         method: "PUT",
    //         headers: {
    //             'Content-type': 'application/json'
    //         },
    //         body: JSON.stringify({
    //             name: name,
    //             password: password,
    //             age: age,
    //         })
    //     }).then(function (response) {
    //         return response.json()
    //     }).then(function (data) {
    //         console.log(data)
    //     })
    //     setTimeout(test,300);
    //     function test() {
    //         document.location.href = 'index1.html'
    //
    //     }
    // });
    async function getAllUsers() {
        let response = await fetch('http://localhost:8000/api/users')
        let content = await response.json()
            .then(users => {
                let li = `
            <tr>
            <th scope="col">id</th>
            <th scope="col">name</th>
            <th scope="col">password</th>
            <th scope="col">age</th>
            <th style="color: blueviolet" scope="col">edit</th>
            <th style="color: red" scope="col">delete</th>
            </tr>`
                users.forEach(u => {
                    li += `<tr>
                <td>${u.id}</td>
                <td>${u.name}</td>
                <td>${u.password}</td>
                <td>${u.age}</td>
                <td><button class="btn btn-outline-success" data-toggle="modal" data-target="#UpdateUser"
                onclick="updates(${u.id},'${u.name}','${u.password}','${u.age}')"
                >Update</button></td>
                <td><button data-id="${u.id}" class="btn"><a href="#" id="delete-post">Delete</a></button></td>
            </tr>`
                });
                document.getElementById("users_table").innerHTML = li;
            })
    }
    getAllUsers()
    // onclick="updateUser2(${u.id},${u.name},${u.password},${u.age})"
    function updates(id,name,password,age) {
        console.log("test")
        let ht = `                 <form id="registerEdit" >
                     <div class="form-group" align="center">
                         <label for="name">Name</label>
                         <br>
                         <input type="text" class="control-input col-sm-10" id="nameEdit" value="${name}">
                     </div>
                     <div class="form-group" align="center">
                         <label for="password">Password</label>
                         <br>
                         <input type="text" class="control-input col-sm-10" id="passwordEdit" value="${password}">
                     </div>
                     <div class="form-group" align="center">
                         <label   for="age">Age</label>
                         <br>
                         <input type="number" class="control-input col-sm-10"id="ageEdit" value="${age}">
                     </div>
                     <div class="form-group" align="center">
                     </div>
                     <!--                    <a href="#" class="card-link">Edit</a>-->
                     <!--                    <a href="#" class="card-link">Delete</a>-->
                     <!--                    <div class="form-group" align="center">-->
            <!--                        <input type="submit" value="add User">-->
        <!--                    </div>-->
        <div class="modal-footer">
        <button class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button class="btn btn-outline-success" type="submit">Save</button>
        </div>
        </form>
        `;
        document.getElementById("EditUserTest").innerHTML = ht;
        const editForm = document.getElementById('registerEdit');
        editForm.addEventListener('submit', async function (event) {
        event.preventDefault();
        let nameE = document.getElementById('nameEdit').value;
        let passwordE = document.getElementById('passwordEdit').value;
        let ageE = document.getElementById('ageEdit').value;
        console.log(nameE)
        console.log(passwordE)
        console.log(ageE)
        fetch(url+`/${id}`, {
        method: "PUT",
        headers: {
        'Content-type': 'application/json'
        },
        body: JSON.stringify({
        name: nameE,
        password: passwordE,
        age: ageE,
        })
        }).then(function (response) {
        return response.json()
        }).then(function (data) {
        console.log(data)
        })
        setTimeout(test,300);
        function test() {
        document.location.href = 'http://localhost:8000/api/admin'
        }
        })
        }
</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>